apiVersion: v1
kind: Namespace
metadata:
  name: straggler-shield
  labels:
    app.kubernetes.io/name: straggler-shield

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: straggler-shield-agent
  namespace: straggler-shield
  labels:
    app.kubernetes.io/name: straggler-shield

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: straggler-shield-agent
  labels:
    app.kubernetes.io/name: straggler-shield
rules:
  # get + watch: read node state and stream Ready condition transitions.
  # patch: write the zombie-quarantine taint to node spec (MergePatch only).
  # update is intentionally omitted â€” full PUT replacement is not required.
  - apiGroups: [""]
    resources: ["nodes"]
    verbs: ["get", "watch", "patch"]

  # patch: write the GPUStraggler condition to the status subresource.
  # Status is a separate subresource in K8s; node RBAC does not cover it.
  - apiGroups: [""]
    resources: ["nodes/status"]
    verbs: ["patch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: straggler-shield-agent
  labels:
    app.kubernetes.io/name: straggler-shield
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: straggler-shield-agent
subjects:
  - kind: ServiceAccount
    name: straggler-shield-agent
    namespace: straggler-shield
